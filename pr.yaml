
name: pr

pr:
  autoCancel: false # Whether to cancel running PR builds when a new commit lands in the branch. Default: true.
  branches: # Branch names to include or exclude for triggering a run.
    include:  # List of items to include.
    - main
  drafts: false


# pool:
#   name: contoso-level0

resources:
  containers:
  - container: rover
    image: aztfmod/rover:1.5.4-2307.2804

steps:
- checkout: self
  fetchTags: true

- bash: |
    echo "git diff --name-only HEAD^"
    git diff --name-only HEAD^
    echo "
    
    changed_files=$(git diff --name-only HEAD^ | grep 'examples' | sort -u)

    for input_string in "${changed_files[@]}"; do
      path_without_filename=$(dirname "$input_string")
      paths_without_filenames+=("$path_without_filename")
    done

    if [ -z "$changed_files" ]; then
      echo "Error: No paths with 'examples' found in the changed files."
      echo "Missing examples folder in the change set.\n"
      git diff --name-only HEAD^
      exit 1
    fi

    echo "##vso[task.setvariable variable=CHANGED_FILES]$paths_without_filenames"
  displayName: Getting the changeset

- script: |
    # Access the CHANGED_FILES variable
    echo "Changed Files: $CHANGED_FILES"
  displayName: 'Print CHANGED_FILES variable'
